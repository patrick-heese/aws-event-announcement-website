<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Announcements</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>Event Announcements</h1>
            <p>Stay tuned for the latest events and announcements!</p>
            <button onclick="subscribeToEvents()">Subscribe to Events</button>
        </header>

        <section id="events-container">
            <h2>Latest Events</h2>
            <ul id="events-list"></ul>
            <button onclick="showCreateEventForm()">Create New Event</button>
        </section>

        <section id="create-event-form">
            <h3>Create New Event</h3>
            <form id="create-event-inner-form" onsubmit="submitNewEvent(event)">
                <label for="event-title">Title:</label>
                <input type="text" id="event-title" required><br>
                <label for="event-date">Date:</label>
                <input type="date" id="event-date" required><br>
                <label for="event-description">Description:</label>
                <textarea id="event-description" required></textarea><br>
                <button type="submit">Submit</button>
            </form>
        </section>

        <footer>
            <p>Subscribe to get notified about new events!</p>
        </footer>
    </div>

    <script>
        const API_BASE = "<YOUR_API_ENDPOINT_URL>";

        window.onload = () => {
            console.log("Page loaded");
            loadEvents().catch(err => console.error("Failed to load events:", err));
        };

        async function loadEvents() {
            try {
                const response = await fetch('events.json');
                if (!response.ok) throw new Error("Could not fetch events.json");
                const events = await response.json();
                displayEvents(events);
            } catch (err) {
                console.error("Error fetching events:", err);
                const eventsList = document.getElementById('events-list');
                eventsList.innerHTML = '<li>Unable to load events at this time.</li>';
            }
        }

        function displayEvents(events) {
            const eventsList = document.getElementById('events-list');
            eventsList.innerHTML = '';
            events.forEach(event => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<strong>${event?.title || "No title"}</strong> - ${event?.date || "No date"}<br>${event?.description || ""}`;
                eventsList.appendChild(listItem);
            });
        }

        function showCreateEventForm() {
            document.getElementById("create-event-form").style.display = "block";
        }

        async function submitNewEvent(e) {
            e.preventDefault();
            const newEvent = {
                title: document.getElementById("event-title").value,
                date: document.getElementById("event-date").value,
                description: document.getElementById("event-description").value
            };

            try {
                const response = await fetch(`${API_BASE}/create-event`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newEvent)
                });
                const result = await response.json();
                if (response.ok) {
                    alert(result.message || "Event created successfully!");
                    loadEvents();
                    document.getElementById("create-event-inner-form").reset(); // Fixed: reset the form
                    document.getElementById("create-event-form").style.display = "none";
                } else {
                    alert("Failed to create new event.");
                    console.error(result);
                }
            } catch (err) {
                console.error(err);
                alert("Error creating new event. Please try again.");
            }
        }

        async function subscribeToEvents() {
            const email = prompt("Enter your email to subscribe to event notifications:");
            if (!email) return alert("Email is required.");

            try {
                const response = await fetch(`${API_BASE}/subscribe`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                const data = await response.json();
                if (response.ok && data.message) {
                    alert(data.message + " Please check your email to confirm subscription.");
                } else {
                    alert("Subscription failed. Please try again.");
                    console.error("Unexpected response:", data);
                }
            } catch (err) {
                console.error(err);
                alert("Error subscribing to events. Please try again later.");
            }
        }
    </script>
</body>

</html>
